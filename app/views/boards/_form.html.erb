<%= form_with model: @board, local: true do |f| %>
  <%= render 'shared/error_messages', object: f.object %>
  <div class="form-group">
    <%= f.label :title %>
    <%= f.text_field :title, class: 'form-control mb-3' %>
  </div>

  <div class="form-group">
    <%= f.label :body %>
    <%= f.text_area :body, class: 'form-control mb-3' %>
  </div>

  <div class="form-group">
    <%= f.label :board_image %>
    <%= f.file_field :board_image, onchange: 'previewImage()', class: 'form-control mb-3', accept: 'image/*' %>
    <%= f.hidden_field :board_image_cache %>
  </div>
  <div class="mt-3 mb-3">
    <%= image_tag board.board_image.url,
                      class: 'rounded-ciecle',
                      id: 'preview',
                      size: '100x100' %>

  </div>

  <%= f.submit '掲示板作成', class: 'btn btn-primary'%>
<% end %>

<script>
function previewImage() {
  const target = this.event.target;
  const file = target.files[0];
  const reader = new FileReader();
  reader.onloadend = function () {
    const preview = document.querySelector("#preview")
    if(preview) {
      preview.src = reader.result;
    }
  }
  if (file) {
    reader.readAsDataURL(file);
  }
}
</script>